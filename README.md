GIS in UE5

This project aims to create a basic GIS viewer inside of Unreal Engine 5 by taking advantage of the geometry script and shapefile reader (by Isara Tech.) plugins. A few warnings before using this project. Firstly the project is currently VERY memory intensive. On a PC with 64GB of RAM I find that it will crash after building around 15,000 pieces of data (where each piece of data has, on average, 30 vertexes). Secondly, I have yet to find a sorting algorthim within Unreal which allows for perfectly accurate data matching. This means the data displayed should not be used for any professional purpose. I made this as a fun test of my own skills and to learn more about the engine.

With all that out the way, how can you use this program? In brief, there are 2 maps you need to use to make it work:

1) The building map
2) The viewing map

To make it work open up the dynamic mesh test actor and paste in the location of your desired shapefile. Then let it build in the test map and view it in the viewing map. You may want to open the BP_GenerateMeshes blueprint (inside reset meshes) to remove the data the program comes with (although depending on the size of the shapefile this may not be necessary). To view data on the map copy the same location into the open DBF function inside of the BP_StaticMeshOnly blueprint. You will need figiure out which field value corresponds to what value in your shapefile and work from there. Again the data may be in the right place, but it also might be completely wrong... So take the data shown with a pinch of salt and don't use it for commercial or professional purposes.

Now on to the fun part, how it works and more information!

The building map is an empty map with only a construction object included. This uses the geometry script to convert the shapefile data into chunks of 3D model data. These 3D models can be viewed in the viewing map. The project is set up to use with the 2019 English index of multiple deprivation, although it can be used with any shapefile. As far as I can tell (because there is very little documentation on the geometry script), it appears to consume resources exponentially as the number of verticies increases. Hence, by chunking the data, I can reset the geometry script process and create a more linear increase in resource use rather than an exponential one. Since there is a time and memory cost to copying the data from the dynamic mesh to the static mesh simply creating a static mesh for each polygon would be extremely slow. Therefore a balance is required between choosing a chunk size which doesn't cause the exponential geometry script function or the copy to static mesh function to become time consuming. On my PC I found the ideal chunk size to be around 256 but your milage may vary. Ideally, I would have a program run which would create chunks and save them to a storage device (removing them from memory) in real time, however, since geometry script only supports creating chunks within the construction script I need to generate the required number of chunks, then copy the correct mesh data into the these chunks. 

As a result, 2 blueprints need to be run to generate the script. The first is called BP_GenerateChunks and is located inside the resetmeshes folder. **WARNING: Since static meshes can only be created inside of the construction script opening this will reset all meshes to a basic cone**. The number of chunks can be determined by the number of times this program loops. The second is called BP_DynamicMeshTestActor. This program runs at runtime inside of the building map. Firstly, to remove any memory leaks the garbage collector is set to run every frame... This isn't in any way ideal but it does reduce the memory hit a bit, at the cost of performance. The assets created by BP_GenerateMeshes are then collected from the asset registry and stored in an array. The order in which data is collected appears to be somewhat random (or at least, I haven't figured it out yet). As a result the static meshes won't work from top to bottom. This is also why the data doesn't line up where it should. Since I don't (yet) understand how Unreal is pulling data from the asset registry I can't get the data to match to the correct location, hence causing inaccuracies in the data presentation. Still, it will generate a 3D model for you and colour it in!

The colouring in process works by allocating an element index to each shapefile then creating a dynamic material instance for each shapefile. I tried using custom primitives or per instance custom data, however, these wouldn't work unless each shapefile was it's own static mesh. So while dynamic material instances aren't as optimal as a single customised material instance the end result is still performant enough that I don't feel the time spent baking all of the indvidual shapefiles would be worthwhile tradeoff. 

And that's how it works! Obviously there a whole bunch of things I would like to improve, however, I feel that if I wanted to create a better version of this I would be better off finally learning something like Vulkan and working at a much lower level than blueprints. The amount of work required to do this would be fairly immense for a fun after work project though so I'm going to stick with what I have and move on to teaching myself another part of the engine. 
